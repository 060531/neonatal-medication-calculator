<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Meropenem Calculation</title>
<style>
  /* ========== Theme tokens ========== */
  :root{
    --blue-900:#0b2b7a;
    --blue-700:#1e57d2;
    --sky-50:#eef7ff;
    --sky-100:#d7ecff;
    --panel:#e6f3ffb8;
    --text:#0f172a;

    --floatbar-gap: clamp(80px, 16vw, 110px);
    --page-gutter: 12px;
  }

  html, body { overflow-x: hidden; height: 100%; }
  *, *::before, *::after { box-sizing: border-box; }
  img, video, canvas, svg { max-width: 100%; height: auto; }
  pre, code { white-space: pre-wrap; word-break: break-word; }

  body{
    margin:0; min-height:100svh;
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial, "Helvetica Neue", Helvetica, sans-serif;
    color:var(--text); text-align:center;
    background:none;
    padding-left:max(0px, env(safe-area-inset-left));
    padding-right:max(0px, env(safe-area-inset-right));
  }
  body::before{
    content:""; position:fixed; inset:0; z-index:-1;
    background-image:url('https://cdn.jsdelivr.net/gh/060531/images/IMG_4200.jpeg');
    background-size:cover; background-position:center; background-repeat:no-repeat;
  }

  .title-badge{
    display:inline-block; margin:28px auto 12px; padding:10px 18px;
    background:var(--blue-900); color:#fff; font-weight:900; font-size:28px;
    border-radius:12px; box-shadow:0 10px 22px rgba(7,29,85,.35), inset 0 1px 0 rgba(255,255,255,.18);
    border:1px solid rgba(255,255,255,.14);
    max-width:min(100%, calc(100vw - calc(var(--page-gutter)*2)));
  }

  .container{
    width:min(820px, calc(100vw - calc(var(--page-gutter)*2)));
    margin:0 auto 12px; padding:20px;
    background:var(--panel);
    border:1px solid #b9d9ff; border-radius:16px;
    box-shadow:0 8px 24px rgba(15,23,42,.18);
    backdrop-filter: blur(6px) saturate(120%);
    -webkit-backdrop-filter: blur(6px) saturate(120%);
  }

  .calc-box{
    margin:14px auto 20px; max-width:740px; padding:16px;
    background:linear-gradient(180deg, var(--sky-100), var(--sky-50));
    border:1px solid #b7d6ff; border-radius:14px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 8px 18px rgba(0,0,0,.06);
    padding-left:max(12px, var(--page-gutter));
    padding-right:max(12px, var(--page-gutter));
  }
  .calc-row{
    display:flex; flex-direction:column; align-items:center; gap:10px;
  }

  .form-row{
    display:grid;
    grid-template-columns:auto 1fr;
    align-items:center;
    column-gap:10px;
    width:100%;
    max-width:560px;
    margin:6px auto;
  }
  .form-row > label{
    font-weight:800;
    color:#0b2b7a;
    white-space:nowrap;
    max-width:46vw;
    line-height:1.2;
  }
  .form-row > input[type="number"],
  .form-row > select{
    min-width:0; width:100%;
    padding:10px 12px; border-radius:10px; border:1px solid #c7d9f9;
    background:#fff; text-align:center; font-size:16px; box-sizing:border-box;
  }

  .subtitle{margin:0 0 12px; color:#e20707; text-shadow:0 2px 6px rgba(0,0,0,.35); font-weight:700;}
  .highlight{ background:#fde047; padding:6px; border-radius:6px; font-weight:800; }
  .pill{ display:inline-block; padding:2px 6px; border-radius:6px; background:#e01b1b; color:#fff; font-weight:800; }

  .btn{
    appearance:none; border:none; border-radius:10px; cursor:pointer;
    padding:10px 16px; font-weight:800; color:#fff; text-decoration:none;
    box-shadow:0 6px 0 rgba(10,30,85,.25);
    transition: transform .06s ease, filter .2s ease;
  }
  .btn:hover{ filter:brightness(1.05); transform:translateY(-1px); }
  .btn:active{ transform:translateY(1px); }
  .btn-blue{ background:var(--blue-700); }
  .btn-red{ background:#e71f1f; }
  .btn-cyan{ background:#049bb5; }

  .result{
    text-align:left; margin:14px auto; max-width:740px; padding:14px;
    background:#f7fbff; border:1px dashed #cfe3ff; border-radius:12px;
    padding-left:max(12px, var(--page-gutter)); padding-right:max(12px, var(--page-gutter));
  }
  .result b{ color:#0b2b7a; }
  .mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; background:#1d3e8c; color:#fff; padding:2px 6px; border-radius:6px; font-weight:800; }
  .muted{ color:#334155; }
  .section-head{ text-align:left; font-weight:900; color:#0b2b7a; margin:18px 0 6px; text-decoration: underline; }
  .bullet{ text-align:left; margin:0 0 10px 0; }
  .bullet ul{ margin:6px 0 0 22px; }
  .order-line{ font-weight:900; margin:0 0 6px; text-align:center; }
  .left-align{ text-align:left; }
  .hidden{ display:none !important; }

  .float-actions{
    position:fixed; left:50%; transform:translateX(-50%);
    bottom: calc(10px + env(safe-area-inset-bottom, 0px)); z-index:1000;
    display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap;
    padding:8px 10px; border-radius:14px;
    background:rgba(15,23,42,.35); border:1px solid rgba(255,255,255,.2);
    box-shadow:0 8px 18px rgba(2,8,23,.28);
    backdrop-filter: blur(8px) saturate(120%); -webkit-backdrop-filter: blur(8px) saturate(120%);
    width:min(540px, calc(100vw - calc(var(--page-gutter)*2)));
    max-width: calc(100vw - calc(var(--page-gutter)*2));
  }

  footer.page-footer{
    text-align:center; color:#ffffff; text-shadow:0 2px 6px rgba(0,0,0,.5);
    margin: 6px 0 var(--floatbar-gap);
    padding-left: var(--page-gutter); padding-right: var(--page-gutter);
    font-size: clamp(12px, 3.2vw, 16px); line-height:1.4;
  }

  @media (max-width:640px){
    .title-badge{ font-size:22px; padding:8px 14px; }
    .container{ padding:14px; }
    .form-row > label{ font-size:14px }
    .form-row > input[type="number"], .form-row > select{ font-size:14px; padding:8px 10px; height:38px }
  }
  @media (max-width:360px){
    .form-row > label{ font-size:13px; max-width:42vw }
    .form-row > input[type="number"], .form-row > select{ font-size:13px; padding:7px 9px; height:36px }
  }
</style>

</head>
<body>

  <div class="title-badge">Meropenem : 1000 mg / vial → reconst. to 50 mg/ml</div>

  <div class="container">
    <!-- รอบที่ 1: คำนวณ mg → ml -->
    <div class="calc-box">
      <form id="meropenem-dose-form"
            class="calc-row"
            action="./meropenem.html"
            method="post">
        <input type="hidden" name="action" value="dose" />
        <div class="form-row">
          <label for="dose">กรอกขนาดยา (mg):</label>
          <input type="number" id="dose" name="dose" placeholder="ขนาดยา (mg)"
                 required step="0.01"
                 value="">
        </div>
        <button type="submit" class="btn btn-blue">คำนวณ</button>
      </form>
    </div>

    

    <!-- ผลลัพธ์รอบแรก -->
    <div id="dose-result"
         class="result"
         style="display:none">
      
    </div>

    <!-- รอบที่ 2: เลือกเงื่อนไข -->
    <div id="meropenem-cond-box"
         class="calc-box hidden">
      <form id="meropenem-mult-form"
            class="calc-row"
            action="./meropenem.html"
            method="post">
        <input type="hidden" name="action" value="condition" />
        <input type="hidden" id="dose_hidden" name="dose_hidden"
               value="">
        <input type="hidden" id="result_ml_hidden" name="result_ml_hidden"
               value="">

        <div class="form-row">
          <label for="multiplication">เลือกเงื่อนไข:</label>
          <select id="multiplication" name="multiplication" required>
            <option value="" disabled selected>— เลือก —</option>
            <option value="3" >3 เท่า (รวมเป้าหมาย 9 ml)</option>
            <option value="6" >6 เท่า (รวมเป้าหมาย 6 ml)</option>
          </select>
        </div>
        <button type="submit" class="btn btn-blue">คำนวณต่อ</button>
      </form>
    </div>

    <!-- ผลลัพธ์รอบที่ 2 -->
    <div id="mult-result"
         class="result"
         style="display:none">
      
    </div>

    

    <!-- หมายเหตุ/วิชาการ -->
    <div class="bullet">
      <p class="section-head">แนวทางขนาดยา</p>
      <ul class="muted">
        <li><b>ขนาดยา:</b> 20 – 40 mg/kg/dose</li>
      </ul>

      <p class="section-head">Solvent (การเตรียม)</p>
      <ul class="muted">
        <li>Sterile water 19 ml → ได้สารละลายไม่มีสี 20 ml</li>
        <li><u>ความแรงหลังผสม:</u> <b>50 mg/ml</b></li>
      </ul>

      <p class="section-head">Solution</p>
      <ul class="muted">
        <li>0.9% Normal saline solution (NSS)</li>
        <li>5% Dextrose in water (ความคงตัวลดลง)</li>
      </ul>

      <p class="section-head">ความเข้มขณะให้ (สูงสุด)</p>
      <ul class="muted">
        <li>≤ 20 mg/ml (กรณีจำกัดน้ำ)</li>
        <li>≤ 50 mg/ml (ข้อมูล รพ.เด็ก)</li>
      </ul>

      <p class="section-head">ระยะเวลาในการบริหารยา</p>
      <ul class="muted">
        <li>30 mins</li>
      </ul>

      <p class="section-head">ความคงตัวหลังเจือจาง</p>
      <ul class="muted">
        <li>24 ชั่วโมง ที่อุณหภูมิห้อง</li>
      </ul>

      <p class="section-head">ข้อควรระวัง/การติดตาม เพื่อป้องกัน Type A ADR</p>
      <ul class="muted">
        <li>Anaphylaxis ระหว่างการให้ครั้งแรก</li>
      </ul>
    </div>
  </div><!-- /container -->

  <footer class="page-footer">
    <p>Developed by Sukhontha Boonsookchan | update 2025-11-15</p>
  </footer>

  <div class="float-actions">
    <a href="./Medication_administration.html" class="btn btn-cyan" data-nav="med">Back</a>
    <a href="./index.html" class="btn btn-red" data-nav="home">Back to Home</a>
  </div>

  <!-- JS: โหมด docs (github.io) เหมือน gentamicin -->
  <script>
  (function () {
    const host = window.location.hostname || "";
    const isGithub = host.endsWith("github.io");

    // ถ้าไม่ใช่ docs → ให้ Flask ทำเอง
    if (!isGithub) return;

    const doseForm      = document.getElementById('meropenem-dose-form');
    const multForm      = document.getElementById('meropenem-mult-form');
    const doseResultEl  = document.getElementById('dose-result');
    const multResultEl  = document.getElementById('mult-result');
    const condBox       = document.getElementById('meropenem-cond-box');
    const doseInput     = document.getElementById('dose');
    const doseHidden    = document.getElementById('dose_hidden');
    const resultHidden  = document.getElementById('result_ml_hidden');
    const multSelect    = document.getElementById('multiplication');

    if (!doseForm || !doseResultEl || !condBox) return;

    const CONC = 50.0;

    function createOrGetBox(id, refNode) {
      let box = document.getElementById(id);
      if (!box) {
        box = document.createElement('div');
        box.id = id;
        box.className = 'result';
        refNode.parentNode.insertBefore(box, refNode.nextSibling);
      }
      return box;
    }

    // รอบ 1: mg → ml
    doseForm.addEventListener('submit', function (e) {
      e.preventDefault();
      const doseVal = parseFloat(doseInput.value || '0');
      if (isNaN(doseVal) || doseVal <= 0) {
        alert('กรุณากรอกขนาดยา (mg) ให้ถูกต้อง');
        return;
      }

      const resultMl = doseVal / CONC;

      doseHidden.value   = doseVal.toFixed(2);
      resultHidden.value = resultMl.toFixed(2);

      doseResultEl.innerHTML = `
        <p class="order-line"><b>Order:</b> Meropenem ${doseVal.toFixed(2)} mg</p>
        <div class="left-align muted">
          <p><b>ความแรงอ้างอิงหลังผสม:</b> เติม Sterile water 19 ml → ได้สารละลาย 20 ml ⇒ <b>50 mg/ml</b></p>
          <p><b>สูตรคำนวณ:</b> <span class="mono">ml = mg ÷ 50</span></p>
          <p>แทนค่า: <span class="mono">${doseVal.toFixed(2)} ÷ 50</span> =
            <span class="pill">${resultMl.toFixed(2)} ml</span></p>
          <p><b>ดังนั้น:</b> ${doseVal.toFixed(2)} mg =
            <span class="pill">${resultMl.toFixed(2)} ml</span></p>
        </div>
      `;
      doseResultEl.style.display = 'block';

      condBox.classList.remove('hidden');
      multResultEl.style.display = 'none';

      const extra = document.getElementById('gh-meropenem-extra');
      if (extra) extra.remove();
    });

    // รอบ 2: 3X / 6X
    if (multForm && multResultEl && multSelect) {
      multForm.addEventListener('submit', function (e) {
        e.preventDefault();

        const doseVal = parseFloat(doseHidden.value || doseInput.value || '0');
        const baseMl  = parseFloat(resultHidden.value || '0');
        const mult    = parseInt(multSelect.value || '0', 10);

        if (isNaN(doseVal) || doseVal <= 0 ||
            isNaN(baseMl) || baseMl <= 0 ||
            (mult !== 3 && mult !== 6)) {
          alert('กรุณากรอกข้อมูลให้ครบถ้วน และเลือกตัวคูณให้ถูกต้อง');
          return;
        }

        const total = baseMl * mult;
        let detailHtml = '';

        if (mult === 3) {
          if (total < 9) {
            const need = 9 - total;
            detailHtml = `
              <p><b>ดังนั้น สารละลายที่ต้องผสม :</b> (9 − ${total.toFixed(2)}) =
                <b>${need.toFixed(2)} ml</b></p>
            `;
          } else {
            detailHtml = `<p><b>**ดูดยา : 9 ml ไม่ต้องผสมสารละลาย**</b></p>`;
          }
          detailHtml += `
            <p class="highlight">
              <b>ปริมาณยาที่บริหารเข้าทารก = 3 ml → ตั้งอัตรา 6 ml/hr</b>
            </p>
          `;
        } else if (mult === 6) {
          if (total < 6) {
            const need = 6 - total;
            detailHtml = `
              <p><b>ดังนั้น สารละลายที่ต้องผสม :</b> (6 − ${total.toFixed(2)}) =
                <b>${need.toFixed(2)} ml</b></p>
            `;
          } else {
            detailHtml = `<p><b>**ดูดยา : 6 ml ไม่ต้องผสมสารละลาย**</b></p>`;
          }
          detailHtml += `
            <p class="highlight">
              <b>ปริมาณยาที่บริหารเข้าทารก = 1 ml → ตั้งอัตรา 2 ml/hr</b>
            </p>
          `;
        }

        multResultEl.innerHTML = `
          <p class="order-line"><b>ผลลัพธ์หลังจากคูณ ${mult} เท่า = ${total.toFixed(2)} ml</b></p>
          <div class="left-align">
            ${detailHtml}
          </div>
        `;
        multResultEl.style.display = 'block';

        // กล่องคำอธิบายแบบ content_extra
        let config;
        if (mult === 3) {
          config = {
            message: "การบริหารยาโดย Intermittent intravenous infusion pump",
            details: [
              "สำหรับทารกที่มีน้ำหนักมากกว่า 1,500 กรัม",
              "กำหนดให้ปริมาณสารละลายยา (ปริมาณยา + สารละลายเจือจางยา) = 8 ml.",
              "(ความจุของ Extension Tube ประมาณ 5 ml. + Volume ที่ต้องบริหารเข้าผู้ป่วย 3 ml.)",
              "<div style='text-align:center'>(3X + สารละลายเจือจางยา Up to 9 mL)</div>",
              "การเตรียมยา:",
              "1) คำนวณปริมาณยาที่ต้องการใช้เป็นมิลลิลิตร (ml.) แทนค่าในสูตร",
              "2) ใช้ Syringe ขนาดที่เหมาะสม ดูดปริมาณยาที่ต้องการเตรียมไว้",
              "3) ใช้ Syringe ขนาด 10 ml. หรือ 20 ml. ดูดปริมาณสารละลายเจือจางยาเตรียมไว้",
              "4) ผสมยาใน Syringe ที่มีสารละลายเจือจางยาอยู่ Mixed ให้เข้ากัน",
              "5) ต่อ Syringe กับ Extension Tube นำไปวางบน Syringe pump กด Start ตั้งอัตรา ~6 ml/hr.",
              "6) Purge ยาให้ทั่วท่อโดยการดัน Syringe 3 ml. แล้วจึงบริหารผู้ป่วย",
            ]
          };
        } else {
          config = {
            message: "การบริหารยาโดย Intermittent intravenous infusion",
            details: [
              "สำหรับทารกที่มีน้ำหนักน้อยกว่า 1,500 กรัม",
              "1) กำหนดให้สารละลายยาซึ่งบริหารเข้าสู่ผู้ป่วยปริมาณเท่ากับ = 1 ml",
              "2) ให้ X คือ ปริมาณยาที่ต้องการเตรียม กำหนดสูตรในการเตรียมสารละลายยา ดังนี้:",
              "<div style='text-align:center'>6X + สารละลายเจือจางยา Up to 6 mL</div>",
              "3) จากข้อ 2 จะได้สารละลายทั้งหมด 6 ml. ซึ่งหมายถึง ความจุของ Extension Tube ประมาณ 5 ml. + Volume ที่ต้องการบริหารเข้าสู่ผู้ป่วย 1 ml.",
              "4) บริหารโดยใช้ Syringe pump ตั้งอัตราเร็ว ~2 ml/hr",
            ]
          };
        }

        const extraBox = createOrGetBox('gh-meropenem-extra', multResultEl);
        let extraHtml =
          "<p style='font-weight:900; text-align:center; margin:6px 0'>" +
          config.message + "</p><div class='muted'>";

        config.details.forEach(function (d) {
          if (d.indexOf("Up to") !== -1) {
            extraHtml +=
              "<div style='background:#ffeb3b; font-weight:700; padding:8px; " +
              "text-align:center; border-radius:6px; margin:10px 0'>" +
              d + "</div>";
          } else {
            extraHtml += "<p style='margin:6px 0'>" + d + "</p>";
          }
        });

        extraHtml += "</div>";
        extraBox.innerHTML = extraHtml;
      });
    }
  })();
  </script>

</body>
</html>