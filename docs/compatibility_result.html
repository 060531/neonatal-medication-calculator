<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Result analyze (Compatibility)</title>

  <!-- PWA meta -->
  <meta name="theme-color" content="#0ea5a6" />
  <link rel="manifest" href="./static/manifest.webmanifest">

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="./static/icons/icon-192.png">

  <!-- CSS/JS หลัก -->
  <link rel="stylesheet" href="./static/style.css">
  <script defer src="./static/app.js"></script>

  <style>
    :root{ color-scheme: light only; }

    html,body{
      height:100%;
    }

    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      margin:0;
      padding:0;
      text-align:center;
      background-image:url('https://cdn.jsdelivr.net/gh/060531/images/IMG_4200.jpeg');
      background-size:cover;
      background-repeat:no-repeat;
      background-position:center;
      background-attachment:fixed;
      color:#0f172a;
    }

    .page-wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 16px 96px;
      box-sizing:border-box;
      backdrop-filter: blur(2px);
    }

    .result-card{
      max-width:720px;
      width:100%;
      background:#ffffffee;
      border-radius:20px;
      padding:28px 20px 24px;
      box-shadow:0 18px 45px rgba(15,23,42,.22);
      text-align:center;
    }

    h1.title-badge{
      display:inline-block;
      margin:32px auto 16px;
      padding:12px 32px;
      font-size:24px;
      border-radius:999px;
      background:linear-gradient(120deg,#0ea5a6,#059669);
      color:#f9fafb;
      box-shadow:0 12px 30px rgba(5,150,105,.35);
    }

    h2{
      margin:0 0 12px;
      font-size:22px;
      color:#0369a1;
    }

    #drug-names{
      font-weight:600;
      margin-bottom:4px;
    }

    #result-line{
      font-size:17px;
      margin:12px 0;
    }

    #detail-line{
      font-size:14px;
      color:#374151;
    }

    .legend{
      margin-top:16px;
      font-size:13px;
    }

    .legend span{
      margin:0 6px;
      white-space:nowrap;
    }

    .dot{
      display:inline-block;
      width:10px;
      height:10px;
      border-radius:999px;
      margin-right:4px;
    }
    .dot.c{ background:#22c55e; }
    .dot.i{ background:#ef4444; }
    .dot.u{ background:#eab308; }
    .dot.nd{ background:#6b7280; }

    .btn-row{
      margin-top:20px;
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .btn{
      border:none;
      border-radius:999px;
      padding:8px 22px;
      font-size:15px;
      cursor:pointer;
      font-weight:600;
    }

    .btn-primary{
      background:#16a34a;
      color:#f9fafb;
    }

    .btn-secondary{
      background:#e5e7eb;
      color:#111827;
    }

    footer{
      position:fixed;
      left:0; right:0; bottom:0;
      text-align:center;
      font-size:11px;
      color:#f9fafb;
      text-shadow:0 2px 6px rgba(0,0,0,.7);
      padding:6px 4px 8px;
    }

    @media (max-width:480px){
      h1.title-badge{
        font-size:18px;
        padding:10px 22px;
        margin-top:20px;
      }
      .result-card{
        padding:22px 14px 18px;
      }
    }
  </style>
</head>
<body>
  <!-- หัวข้อใหญ่เหมือนหน้า compatibility -->
  <h1 class="title-badge">ตรวจสอบความเข้ากันได้ของยา<br>Drug Compatibility</h1>

  <div class="page-wrap">
    <div class="result-card">
      <h2>Result analyze</h2>
      <p id="drug-names">-</p>
      <hr style="max-width:480px;border:none;border-top:1px solid #e5e7eb;margin:10px auto 14px">

      <p id="result-line">ND Unknown</p>

      <p id="detail-line">
        ยังไม่พบรายละเอียดคู่นี้ในระบบ (ตรวจคู่ชื่ออีกครั้ง / รออัปเดตเพิ่มเติม)
      </p>

      <div class="btn-row">
        <a href="compatibility.html" class="btn btn-primary">↻ New check</a>
        <a href="index.html" class="btn btn-secondary">Home</a>
      </div>

      <div class="legend">
        <span><span class="dot c"></span>C = Compatible / ผสมร่วมได้</span>
        <span><span class="dot i"></span>I = Incompatible / ห้ามผสม</span>
        <span><span class="dot u"></span>U = Uncertain / ไม่ชัดเจน</span>
        <span><span class="dot nd"></span>ND = No data / ไม่มีข้อมูล</span>
      </div>
    </div>
  </div>

  <footer>
    Developed by Sukhontha Boonsookchan | update 2025-11-24
  </footer>

  <script>
    // ---- อ่านค่าจาก query string ----
    const params = new URLSearchParams(window.location.search);
    const drugA = params.get('drug_a') || params.get('drug') || '';
    const drugB = params.get('drug_b') || '';

    const nameLine   = document.getElementById('drug-names');
    const resultLine = document.getElementById('result-line');
    const detailLine = document.getElementById('detail-line');

    if (nameLine && drugA && drugB) {
      nameLine.textContent = `${drugA} with ${drugB}`;
    }

    function canonicalName(name) {
      return name
        ? name.trim().toLowerCase().replace(/\s+/g, ' ')
        : '';
    }

    const statusMap = {
      'C': 'C = Compatible / ผสมร่วมได้',
      'I': 'I = Incompatible / ห้ามผสม',
      'U': 'U = Uncertain / ไม่ชัดเจน',
      'ND': 'ND = No data / ไม่มีข้อมูล'
    };

    // ---- ดึงฐานข้อมูลจาก static/compat_lookup.json ----
    fetch('static/compat_lookup.json')
      .then(res => res.json())
      .then(data => {
        const key1 = canonicalName(drugA) + '|' + canonicalName(drugB);
        const key2 = canonicalName(drugB) + '|' + canonicalName(drugA);
        const pair = data[key1] || data[key2];

        if (!pair) {
          // ถ้าไม่พบก็ปล่อยให้เป็น ND Unknown ตาม default
          return;
        }

        const statusText = statusMap[pair.status] || pair.status;

        if (resultLine) {
          resultLine.textContent =
            `${pair.drug_a} + ${pair.drug_b} → ${statusText}`;
        }

        let html = '';
        if (pair.summary_th) {
          html += pair.summary_th + '<br>';
        } else if (pair.note) {
          html += pair.note + '<br>';
        }
        if (pair.reference) {
          html += 'อ้างอิง: ' + pair.reference;
        }
        if (!html) {
          html = 'มีข้อมูลสถานะ แต่ยังไม่มีคำอธิบายรายละเอียดในระบบ';
        }

        if (detailLine) {
          detailLine.innerHTML = html;
        }
      })
      .catch(err => {
        console.error(err);
        if (resultLine) {
          resultLine.textContent = 'เกิดข้อผิดพลาดในการอ่านฐานข้อมูล';
        }
      });
  </script>
</body>
</html>
