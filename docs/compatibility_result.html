<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Result analyze (Compatibility)</title>

  <link rel="manifest" href="./static/manifest.webmanifest">
  <link rel="stylesheet" href="./static/style.css?v=2025-11-30-04">

  <style>
    body{
      font-family: Arial, Helvetica, sans-serif;
      margin:0; padding:0; text-align:center;
      background-image:url("https://cdn.jsdelivr.net/gh/060531/images/IMG_4200.jpeg");
      background-size:cover; background-position:center; background-repeat:no-repeat;
      min-height:100vh; display:flex; flex-direction:column; align-items:center;
      color:#0f172a;
    }
    .container{ max-width:900px; width:100%; padding:20px 12px; box-sizing:border-box; }
    h1{
      display:inline-block; margin:18px 0 14px; padding:12px 18px;
      color:#fff; border-radius:14px;
      background:linear-gradient(135deg,#039eac,#007a8c);
      text-shadow:2px 2px 6px rgba(0,0,0,.55);
    }
    .card{
      background:#ffffffea; border-radius:18px; padding:18px 14px;
      box-shadow:0 18px 45px rgba(15,23,42,.24);
    }
    .pill{ display:inline-block; padding:4px 10px; border-radius:999px; background:#e5f3ff; }
    .statusLine{ margin:10px 0 6px; display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; }
    .statusCode{
      min-width:34px; padding:6px 12px; border-radius:999px;
      color:#fff; font-weight:800; background:#6b7280;
    }
    .msg{
      margin:14px auto 0; padding:12px 14px; border-radius:12px;
      border:1px solid #e5e7eb; background:#f3f4f6; text-align:left;
    }
    .msg[data-status="C"]{ background:#dcfce7; border-color:#86efac; }
    .msg[data-status="I"]{ background:#fee2e2; border-color:#fecaca; }
    .msg[data-status="U"]{ background:#fef9c3; border-color:#fde68a; }
    .msg[data-status="ND"]{ background:#f3f4f6; border-color:#e5e7eb; }
    .actions{ margin-top:16px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
    .btn{ border:none; border-radius:999px; padding:10px 16px; font-weight:800; cursor:pointer; text-decoration:none; display:inline-flex; }
    .btn.green{ background:#16a34a; color:#fff; }
    .btn.gray{ background:#e5e7eb; color:#111827; }
    footer{ margin-top:auto; color:#fff; font-size:12px; padding:10px; text-shadow:2px 2px 5px rgba(0,0,0,.7); }
  </style>
</head>

<body>
  <div class="container">
    <h1>Drug Compatibility</h1>

    <div class="card">
      <div>
        <span class="pill" data-drug-a>Drug A</span>
        <span style="margin:0 8px;">with</span>
        <span class="pill" data-drug-b>Drug B</span>
      </div>

      <div class="statusLine">
        <span class="statusCode" data-status-code>ND</span>
        <span data-status-label>Unknown</span>
      </div>

      <div class="msg" data-message-box data-status="ND">
        <div style="font-weight:800;margin-bottom:6px;" data-note-main>กำลังโหลดข้อมูล…</div>
        <div style="opacity:.9;" data-note-ref></div>
      </div>

      <div class="actions">
        <a class="btn green" href="compatibility.html">↺ New check</a>
        <a class="btn gray" href="index.html">Home</a>
      </div>
    </div>
  </div>

  <footer>Developed by Sukhontha Boonsookchan | update 2025-11-30</footer>

  <script>
    const VERSION = "2025-11-30-04";
    const LOOKUP_URL = `./static/compat_lookup.json?v=${VERSION}`;

    const STATUS_LABEL = {
      C: "Compatible / ผสมร่วมได้",
      I: "Incompatible / ห้ามผสม",
      U: "Uncertain / ไม่ชัดเจน",
      ND: "No data / ไม่มีข้อมูล"
    };
    const STATUS_COLOR = { C:"#22c55e", I:"#ef4444", U:"#eab308", ND:"#6b7280" };

    function canon(s){ return (s||"").toString().trim().toLowerCase().replace(/\s+/g," "); }
    function kAB(a,b){ return canon(a) + "|" + canon(b); }
    function kSorted(a,b){ return [canon(a), canon(b)].sort().join("|"); }

    function applyUI(drugA, drugB, entry){
      document.querySelector("[data-drug-a]").textContent = drugA;
      document.querySelector("[data-drug-b]").textContent = drugB;

      const codeEl = document.querySelector("[data-status-code]");
      const labelEl = document.querySelector("[data-status-label]");
      const mainEl = document.querySelector("[data-note-main]");
      const refEl = document.querySelector("[data-note-ref]");
      const boxEl = document.querySelector("[data-message-box]");

      const status = (entry && entry.status) ? entry.status : "ND";
      const label = STATUS_LABEL[status] || "Unknown";

      codeEl.textContent = status;
      codeEl.style.background = STATUS_COLOR[status] || STATUS_COLOR.ND;
      labelEl.textContent = label;

      boxEl.setAttribute("data-status", status);

      if (!entry){
        mainEl.textContent = "ยังไม่พบรายละเอียดคู่นี้ในระบบ (ตรวจคู่มืออีกครั้ง / สืบค้นเพิ่มเติม)";
        refEl.textContent = "";
        return;
      }

      mainEl.textContent = `${drugA} + ${drugB} → ${status} (${label})`;
      const parts = [];
      if (entry.note) parts.push(entry.note);
      if (entry.source) parts.push("อ้างอิง: " + entry.source);
      refEl.textContent = parts.join(" ");
    }

    async function run(){
      const p = new URLSearchParams(location.search);
      const drugA = (p.get("drug_a") || "Drug A").trim();
      const drugB = (p.get("drug_b") || "Drug B").trim();

      let map = {};
      try {
        const res = await fetch(LOOKUP_URL, { cache: "no-store" });
        if (res.ok) map = await res.json();
      } catch (_) {}

      const entry = map[kAB(drugA,drugB)] || map[kAB(drugB,drugA)] || map[kSorted(drugA,drugB)] || null;
      applyUI(drugA, drugB, entry);
    }
    window.addEventListener("load", run);
  </script>

  <script>
    (function () {
      if (!("serviceWorker" in navigator)) return;
      navigator.serviceWorker.register("./service-worker.js?v=2025-11-30-04", { scope: "./" })
        .catch(console.error);
    })();
  </script>
</body>
</html>
