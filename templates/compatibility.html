{% extends "base.html" %}

{% block title %}ตรวจสอบความเข้ากันได้ของยา (Compatibility){% endblock %}

{% block content %}
<div class="compat-shell">
  <h1 class="compat-title">
    ตรวจสอบความเข้ากันได้ของยา<br>
    <span>Drug Compatibility</span>
  </h1>

  <div class="compat-card">
    <form method="post" action="{{ url_for('core.compatibility_page') }}" class="compat-form">
      <div class="compat-row">
        <div class="compat-field">
          <label for="drug_a">ยา A</label>
          <select id="drug_a" name="drug_a" class="compat-select" required>
          <option value="">-- เลือกยา --</option>
          {% if drugs is defined and drugs %}
            {% for d in drugs %}
              {# รองรับทั้ง object จาก DB และ dict จาก static JSON #}
              {% set label =
                d.generic_name if d.generic_name is defined
                else (d.name if d.name is defined
                else (d.label if d.label is defined else '')) %}
              {% set did = d.id if d.id is defined else (d.value if d.value is defined else '') %}
              <option value="{{ did }}">{{ label }}</option>
            {% endfor %}
          {% endif %}
        </select>
        </div>

        <div class="compat-field">
          <label for="drug_b">ยา B</label>
          <select id="drug_b" name="drug_b" class="compat-select" required>
          <option value="">-- เลือกยา --</option>
          {% if drugs is defined and drugs %}
            {% for d in drugs %}
              {% set label =
                d.generic_name if d.generic_name is defined
                else (d.name if d.name is defined
                else (d.label if d.label is defined else '')) %}
              {% set did = d.id if d.id is defined else (d.value if d.value is defined else '') %}
              <option value="{{ did }}">{{ label }}</option>
            {% endfor %}
          {% endif %}
        </select>
        </div>
      </div>

      <div class="compat-actions">
        <button type="submit" class="btn-check">ตรวจสอบ</button>
        <a href="{{ url_for('core.index') }}" class="btn-home">กลับหน้า Home</a>
      </div>
    </form>

    {% if compat is not none %}
      <div class="compat-result compat-result-{{ status_code|lower }}">
        <p class="compat-pair">
          {{ drug_a_name or 'Drug A' }} + {{ drug_b_name or 'Drug B' }} → <strong>{{ status_code }}</strong>
        </p>
        {% if compat is defined and compat and compat.note %}
        <p class="compat-note">{{ compat.note }}</p>
      {% endif %}
        {% if compat is defined and compat and compat.source %}
        <p class="compat-source">อ้างอิง: {{ compat.source }}</p>
      {% endif %}
      </div>
    {% elif selected_drug_id and selected_co_drug_id %}
      <div class="compat-result compat-result-nd">
        <p>ไม่พบข้อมูลคู่นี้ในฐานข้อมูล</p>
        <p class="compat-note">No data / ไม่มีข้อมูล</p>
      </div>
    {% else %}
      <p class="compat-hint">
        เลือกยา A และยา B แล้วกด “ตรวจสอบ” เพื่อดูผลลัพธ์
      </p>
    {% endif %}

        <div class="compat-legend">
      <span class="dot dot-c"></span> C = Compatible / ผสมร่วมได้
      • <span class="dot dot-i"></span> I = Incompatible / ห้ามผสม
      • <span class="dot dot-u"></span> U = Uncertain / ไม่ชัดเจน
      • <span class="dot dot-nd"></span> ND = No data / ไม่มีข้อมูล
    </div>

  </div>
</div>
{% endblock %}
